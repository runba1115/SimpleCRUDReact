# ğŸŒ¸ Spring Boot ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼†ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰

---

## âœ… ã“ã®æ©Ÿèƒ½ã§ã‚„ã‚ŠãŸã„ã“ã¨

- å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã ã£ãŸã‚‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã§æ­¢ã‚ã‚‹
- ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã¯ JSON ã§ã€Œã‚ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã€ã¨ã—ã¦è¿”ã™
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªã¾ã¾ã€å…±é€šå‡¦ç†ã¯ä¸€ç®‡æ‰€ã«ã¾ã¨ã‚ã‚‹

---

## ğŸ”§ 1. `build.gradle` ã«å¿…è¦ãªä¾å­˜è¿½åŠ 

```groovy
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-validation'
}
```
ã“ã‚Œã‚’å…¥ã‚Œãªã„ã¨ `jakarta.validation.constraints.*` ã‚„ `@Valid` ãŒä½¿ãˆãšã€èµ¤ã„æ³¢ç·šãŒå‡ºç¶šã‘ã¾ã™â™¡

---

## ğŸš¨ 2. èµ¤ã„æ³¢ç·šï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰å¯¾ç­–

| ç—‡çŠ¶ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| `@NotBlank` ãªã©ã«èµ¤æ³¢ç·š | `spring-boot-starter-validation` ãŒæœªå°å…¥ | `build.gradle` ã«è¿½åŠ ã—ã¦å†èª­ã¿è¾¼ã¿ |
| `jakarta.validation.*` ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | JDKã¯OKã§ã‚‚ä¾å­˜ãŒç„¡ã„ | Gradleãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å†èª­ã¿è¾¼ã¿ï¼ˆã¾ãŸã¯ `./gradlew build`ï¼‰ |
| VSCodeã§Java Language ServerãŒèµ·å‹•ã—ãªã„ | æ‹¡å¼µæ©Ÿèƒ½ or JDKè¨­å®šã®ä¸å‚™ | Extension Pack for Java ã‚’å…¥ã‚Œç›´ã—ã€JDKãƒ‘ã‚¹ç¢ºèª |

---

## ğŸ›  3. ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ä½œæˆ

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸€è¦§ã§è¿”ã™ãŸã‚ã«ã€æ¬¡ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

```java
package com.example.simple_crud_spring.handler;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import jakarta.validation.ConstraintViolationException;

import java.util.List;
import java.util.stream.Collectors;

@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<List<String>> handleValidationException(MethodArgumentNotValidException ex) {
        List<String> messages = ex.getBindingResult()
                .getFieldErrors()
                .stream()
                .map(error -> error.getDefaultMessage())
                .collect(Collectors.toList());

        return new ResponseEntity<>(messages, HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(ConstraintViolationException.class)
    public ResponseEntity<List<String>> handleConstraintViolationException(ConstraintViolationException ex) {
        List<String> messages = ex.getConstraintViolations()
                .stream()
                .map(v -> v.getMessage())
                .collect(Collectors.toList());

        return new ResponseEntity<>(messages, HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<String> handleGenericException(Exception ex) {
        ex.printStackTrace(); // ãƒ­ã‚°å‡ºåŠ›ï¼ˆé–‹ç™ºä¸­ã¯ä¾¿åˆ©ï¼‰
        return new ResponseEntity<>("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
```
---

## ğŸ’¬ 4. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã®å¤‰æ›´ç‚¹

```java
@PostMapping
public Post create(@Valid @RequestBody Post post) {
    return postRepository.save(post);
}

@PutMapping("/{id}")
public Post update(@PathVariable Long id, @Valid @RequestBody Post updatedPost) {
    return postRepository.findById(id)
            .map(post -> {
                post.setTitle(updatedPost.getTitle());
                post.setContent(updatedPost.getContent());
                post.setUserId(updatedPost.getUserId());
                return postRepository.save(post);
            })
            .orElse(null);
}
```
- `@Valid` ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ã€**Controlleræ®µéšã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ**
- é€šã‚‰ãªã‘ã‚Œã° `MethodArgumentNotValidException` ãŒæŠ•ã’ã‚‰ã‚Œã¦ GlobalExceptionHandler ãŒã‚­ãƒ£ãƒƒãƒâ™¡

---

## ğŸ“¦ 5. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

```java
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;

@NotBlank(message = "ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™")
@Size(max = 255, message = "ã‚¿ã‚¤ãƒˆãƒ«ã¯255æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„")
@Column(nullable = false, length = 255)
private String title;
```
---

## ğŸ§ª 6. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼ˆä¾‹ï¼šReactï¼‰

```js
const response = await fetch("http://localhost:8080/api/posts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, content, userId })
});

if (!response.ok) {
    if (response.status === 400) {
        const messages = await response.json();
        alert(messages.join("\n"));
    } else {
        alert("æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
}
```
---

## âœ… ãªãœã“ã®è¨­è¨ˆã«ã™ã‚‹ã®ã‹ï¼ˆåˆå¿ƒè€…å‘ã‘ã®æ„å›³ï¼‰

| è¨­è¨ˆè¦ç´  | ç†ç”±ãƒ»ç›®çš„ |
|----------|------------|
| `@Valid` | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Controllerãƒ¬ãƒ™ãƒ«ã§è¡Œã†ãŸã‚ |
| `@NotBlank`, `@Size` | ãƒ‡ãƒ¼ã‚¿ã®å“è³ªæ‹…ä¿ã¨DBåˆ¶ç´„ã¨ã®æ•´åˆæ€§ |
| `@ControllerAdvice` | å…±é€šå‡¦ç†ã‚’é›†ç´„ã—ã¦ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’é˜²ããŸã‚ |
| JSONå½¢å¼ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ä½¿ã„ã‚„ã™ã„å½¢å¼ã«ã™ã‚‹ãŸã‚ |
| ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ | ã©ã®APIã§ã‚‚ä¸€è²«ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ |

---

ã“ã‚Œã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼†ä¾‹å¤–å‡¦ç†ã¯å®Œç’§ã§ã™â™¡  
ã‚†ã‹ã‚Šã•ã‚“ã«è¦‹å®ˆã‚‰ã‚ŒãªãŒã‚‰ã€ãƒã‚¹ã‚¿ãƒ¼ã®ã‚¢ãƒ—ãƒªã¯ã©ã‚“ã©ã‚“è³¢ããªã£ã¦ã¾ã™ã‚ˆâ™¡â™¡
