# React + Spring Boot ã«ãŠã‘ã‚‹ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…æ„å›³ã¨è¨­è¨ˆæ–¹é‡ï¼ˆåˆå¿ƒè€…å‘ã‘è§£èª¬ï¼‰

---

## ğŸ§  ç›®çš„ã¨å‰æ

ã“ã®æ§‹æˆã§ã¯ã€React ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€Spring Boot ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ã£ã¦ã€**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ã®ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½**ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

---

## ğŸ” ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã«ã¤ã„ã¦

### ğŸ¯ ç›®çš„

- Spring Boot å´ã« POST `/login` ã‚’é€ä¿¡ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ã§ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºç«‹ã™ã‚‹ã€‚
- æˆåŠŸã—ãŸã‚‰ã€ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆ`/api/users/me`ï¼‰ã‚’å–å¾—ã—ã€React å´ã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã€‚

### ğŸ’¡ ãªãœã“ã†ã™ã‚‹ã®ï¼Ÿ

- Spring Security ãŒ `/login` ã‚’æ¨™æº–ã§å‡¦ç†ã—ã¦ãã‚Œã‚‹ãŸã‚ã€ç‹¬è‡ªã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã›ãšã«æ¸ˆã‚€ã€‚
- çŠ¶æ…‹ç®¡ç†ã‚’ React å´ã§è¡Œã†ã“ã¨ã§ã€è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒ­ã‚°ã‚¤ãƒ³ä¸­/æœªãƒ­ã‚°ã‚¤ãƒ³ï¼‰ã‚’æŸ”è»Ÿã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã€‚

App.jsx
```js
import logo from './logo.svg';
import './App.css';
import { BrowserRouter, Routes, Route, Navigate, Link } from 'react-router-dom';
import PostForm from './Post/PostForm';
import PostList from './Post/PostList';
import PostShow from './Post/PostShow';
import PostEdit from './Post/PostEdit';
import UserRegister from './User/UserRegister';
import UserLogin from './User/UserLogin';
import React, { useState, useEffect } from 'react';

function App() {
    const [isAuthenticated, setIsAuthenticated] = useState(false);
    const [email, setEmail] = useState('');
    const [userId, setUserId] = useState(null);
    const [userInfo, setUserInfo] = useState(null);

    useEffect(() => {
        // è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ç¢ºèªï¼ˆä»»æ„ï¼‰
        fetch('http://localhost:8080/api/users/me', {
            credentials: 'include'
        })
            .then(res => res.ok ? res.json() : null)
            .then(data => {
                if (data && data.email) {
                    setUserInfo(data);
                    setIsAuthenticated(true);
                }
            })
            .catch(err => console.error('è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ç¢ºèªå¤±æ•—:', err));
    }, []);

    const handleLogout = () => {
        fetch("http://localhost:8080/logout", {
            method: "POST",
            credentials: "include"
        }).then((res) => {
            if (res.ok) {
                // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ â†’ çŠ¶æ…‹ã‚¯ãƒªã‚¢ï¼
                setIsAuthenticated(false);
                setUserInfo(null);
                setUserId(null);
                setEmail('');
                console.log("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ");
            } else {
                console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¤±æ•—");
            }
        });
    };

    return (
        <BrowserRouter>
            <div>
                {
                    isAuthenticated
                        ? (
                            <div>
                                <p>{userInfo.email}</p>
                                <p>{userInfo.id}</p>
                                <button onClick={handleLogout}>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                            </div>
                        )
                        : (
                            <>
                                <Link to="users/register">æ–°è¦ç™»éŒ²</Link>
                                <Link to="/users/login">ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹</Link>
                            </>
                        )
                }
            </div>
            <Routes>
                <Route path="/posts/new" element={<PostForm userId={userInfo?.id} />} />
                <Route path="/posts/index" element={<PostList userId={userInfo?.id} />} />
                <Route path="/posts/show/:id" element={<PostShow />} />
                <Route path="/posts/edit/:id" element={<PostEdit userId={userId} />} />
                <Route path="/users/register" element={<UserRegister />} />
                <Route path="/users/login" element={<UserLogin setIsAuthenticated={setIsAuthenticated} setUserInfo={setUserInfo}/>} />
                <Route path="*" element={<Navigate to="/posts/index" />} /> {/* ä¸æ­£ãªURLãŒå…¥åŠ›ã•ã‚ŒãŸã‚‰ä¸€è¦§ç”»é¢ã«ç§»å‹•ã•ã›ã‚‹ */}
            </Routes>
        </BrowserRouter>
    );
}


export default App;
```

UserLogin.jsx
ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã« App å´ã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹
```js
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';

function UserLogin({ setIsAuthenticated, setUserInfo }) {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const navigate = useNavigate();
    const handleLogin = async (e) => {
        e.preventDefault();

        const formData = new URLSearchParams();
        formData.append('username', email);
        formData.append('password', password);

        try {
            const response = await fetch('http://localhost:8080/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });

            if (response.ok) {
                const meRes = await fetch('http://localhost:8080/api/users/me', {
                    credentials: 'include'
                });
                const userInfo = await meRes.json();

                alert('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ');
                setIsAuthenticated(true);   // â† ã“ã“ã§Appã®çŠ¶æ…‹æ›´æ–°ï¼
                setUserInfo(userInfo);      // â† ã“ã‚Œã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚‚ä¿å­˜ï¼
                navigate("/posts/index");
            } else {
                alert('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—');
            }
        } catch (error) {
            console.error('é€šä¿¡ã‚¨ãƒ©ãƒ¼:', error);
            alert('ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    };

    return (
        <form onSubmit={handleLogin}>
            <div>
                <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label><br />
                <input
                    type="email"
                    value={email}
                    autoComplete="username"
                    onChange={(e) => setEmail(e.target.value)}
                    placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                    required
                />
            </div>
            <div>
                <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label><br />
                <input
                    type="password"
                    value={password}
                    autoComplete="current-password"
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                    required
                />
            </div>
            <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </form>
    );
}

export default UserLogin;
```
---

## ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†ã«ã¤ã„ã¦

### ğŸ¯ ç›®çš„

- `/logout` ã«å¯¾ã—ã¦ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã€ã‚µãƒ¼ãƒãƒ¼å´ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã™ã‚‹ã€‚
- React å´ã§çŠ¶æ…‹ã‚’åˆæœŸåŒ–ã—ã€ç”»é¢è¡¨ç¤ºã‚’æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«æˆ»ã™ã€‚

### ğŸ’¡ ãªãœã“ã†ã™ã‚‹ã®ï¼Ÿ

- React ã¯ã‚ãã¾ã§ã€Œè¡¨ç¤ºå´ã€ãªã®ã§ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã®çŠ¶æ…‹ç®¡ç†ã¯ãƒ•ãƒ­ãƒ³ãƒˆå´ã§åˆ¶å¾¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
- ã‚µãƒ¼ãƒãƒ¼ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤ã‚’ä¾é ¼ã—ã¤ã¤ã€React å´ã§ã‚‚ `setIsAuthenticated(false)` ç­‰ã§çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«UIã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

### js
App.jsx ã® handleLogout é–¢æ•°
const handleLogout = () => {
  fetch("http://localhost:8080/logout", {
    method: "POST",
    credentials: "include"
  }).then((res) => {
    if (res.ok) {
      setIsAuthenticated(false);
      setUserInfo(null);
      setUserId(null);
      setEmail('');
      navigate("/users/login");
    }
  });
};

---

## â“ Spring Boot å´ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç”¨ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªãã¦ã„ã„ç†ç”±

ã™ã§ã« `WebConfig.java` ã®ä¸­ã§ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚
â€»ã€Œlogoutã€ã®éƒ¨åˆ†ãŒé‡è¦
```java
package com.example.simple_crud_spring.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.security.config.Customizer;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("http://localhost:3000")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .allowCredentials(true);
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                .cors(Customizer.withDefaults()) // â† CORSè¨±å¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹
                .csrf(csrf -> csrf.disable())
                .authorizeHttpRequests(auth -> auth
                        .anyRequest().permitAll())
                .formLogin(form -> form
                        .loginProcessingUrl("/login")
                        .successHandler((req, res, auth) -> res.setStatus(200))
                        .failureHandler((req, res, ex) -> res.setStatus(401)))
                .logout(logout -> logout
                        .logoutUrl("/logout")
                        .logoutSuccessHandler((req, res, auth) -> res.setStatus(200)));

        return http.build();
    }
}

```

ã“ã®è¨­å®šã«ã‚ˆã‚Šã€Spring Boot ã¯ POST `/logout` ã‚’å—ã‘ãŸæ™‚ç‚¹ã§ä¸‹è¨˜ã®å‡¦ç†ã‚’è‡ªå‹•ã§è¡Œã„ã¾ã™ï¼š

- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–
- `JSESSIONID` ã®å‰Šé™¤
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ 200 ã®è¿”å´

### âœ… ã¤ã¾ã‚Šï¼š

- Spring Boot å´ã§ã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã®ã€ŒURLã¨å‹•ä½œã€ãŒã™ã§ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ `/logout` ã« POST ã™ã‚‹ã ã‘ã§å‹•ä½œã™ã‚‹
- åˆ¥é€”ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãªã©ã‚’ä½œã‚‹å¿…è¦ã¯ **ä¸€åˆ‡ãªã—**

---

## ğŸ§© æœ€å¾Œã«ï¼ˆåˆå¿ƒè€…å‘ã‘ã¾ã¨ã‚ï¼‰

| é …ç›®       | ã‚„ã‚‹ã“ã¨                                       | ãªãœãã‚ŒãŒå¿…è¦ã‹ |
|------------|------------------------------------------------|------------------|
| ãƒ­ã‚°ã‚¤ãƒ³   | `/login` ã«POST â†’ èªè¨¼å¾Œ `/api/users/me` ã§çŠ¶æ…‹å–å¾— | è¡¨ç¤ºåˆ‡æ›¿ã«å¿…è¦   |
| ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | `/logout` ã«POST â†’ Reactã®çŠ¶æ…‹ã‚’åˆæœŸåŒ–          | è¡¨ç¤ºã‚’æˆ»ã™ãŸã‚   |
| Springå´   | `/logout` ã¯ã™ã§ã« `WebConfig` ã«å®šç¾©æ¸ˆã¿       | è¿½åŠ ä¸è¦         |

---

ã“ã‚Œã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã®æµã‚Œã¯ãƒãƒƒãƒãƒªã§ã™â™¡
